<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskMaster - Collaborative Task Management</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìã</text></svg>">
    <link rel="stylesheet" href="style.css">
    <script>
        // Apply dark mode immediately before page renders to prevent flash
        (function() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.documentElement.classList.add('dark-mode-loading');
            }
        })();
    </script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo">
                    <span class="logo-icon">üìã</span>
                    <h1>TaskMaster</h1>
                </div>
            </div>
            <div class="header-actions">
            <button class="btn btn-nav" onclick="showDashboard()" id="dashboardBtn">Dashboard</button>
            <button class="btn btn-nav" onclick="showProjectsPage()" id="projectsBtn">Projects</button>
            <button class="btn btn-nav" onclick="showMyWorkQuick()" id="myWorkBtn">My Work</button>
            <button class="theme-toggle" onclick="toggleDarkMode()" id="themeToggle" title="Toggle dark mode">
                üåô
            </button>
            <select id="currentUser" class="user-select">
                <option value="">Select User</option>
            </select>
            <button class="btn btn-primary" onclick="showModal('userModal')">+ User</button>
        </div>
        </header>

        <!-- Dashboard View (Project Status Overview) -->
        <div id="dashboardView" class="dashboard-view">
            <h2>Project Dashboard</h2>
            
            <!-- Project Stats by Status -->
            <div class="stats-container">
                <div class="stat-card status-active">
                    <div class="stat-value" id="activeProjects">0</div>
                    <div class="stat-label">Active Projects</div>
                </div>
                <div class="stat-card status-on-hold">
                    <div class="stat-value" id="onHoldProjects">0</div>
                    <div class="stat-label">On Hold</div>
                </div>
                <div class="stat-card status-completed">
                    <div class="stat-value" id="completedProjects">0</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalTasks">0</div>
                    <div class="stat-label">Total Tasks</div>
                </div>
            </div>

            <!-- Projects by Status -->
            <div class="projects-by-status">
                <div class="status-column">
                    <h3 class="status-header status-active">üöÄ Active Projects</h3>
                    <div id="activeProjectsList" class="projects-list-column"></div>
                </div>
                <div class="status-column">
                    <h3 class="status-header status-on-hold">‚è∏Ô∏è On Hold</h3>
                    <div id="onHoldProjectsList" class="projects-list-column"></div>
                </div>
                <div class="status-column">
                    <h3 class="status-header status-completed">‚úÖ Completed</h3>
                    <div id="completedProjectsList" class="projects-list-column"></div>
                </div>
            </div>
        </div>

        <!-- Projects Page (All Projects) -->
<div id="projectsPage" class="projects-page" style="display: none;">
    <div class="page-header">
        <h2>All Projects</h2>
        <div style="display: flex; gap: 10px; align-items: center;">
            <label class="filter-toggle">
                <input type="checkbox" id="myWorkFilter" onchange="toggleMyWorkFilter()">
                <span>Show only my work</span>
            </label>
            <button class="btn btn-primary" onclick="showModal('projectModal')">+ New Project</button>
        </div>
    </div>
    <div id="allProjectsList" class="projects-grid"></div>
</div>

        <!-- Tasks View (shown when project selected) -->
        <div id="tasksView" class="tasks-view" style="display: none;">
            <div class="tasks-header">
                <div>
                    <button class="btn btn-secondary" onclick="backToProjects()">‚Üê Back</button>
                    <h2 id="projectTitle"></h2>
                    <div class="project-status-badges" id="projectStatusBadges"></div>
                </div>
                <div class="tasks-header-actions">
                    <button class="btn btn-secondary" onclick="showProjectStatusModal()">Change Status</button>
                    <button class="btn btn-primary" onclick="showTaskModal()">+ Add Task</button>
                </div>
            </div>

            <!-- Search and Filter Bar -->
            <div class="search-filter-bar">
                <div class="search-box">
                    <input type="text" id="taskSearch" placeholder="üîç Search tasks..." oninput="applyFilters()">
                </div>
                <div class="filter-controls">
                    <select id="filterStatus" onchange="applyFilters()">
                        <option value="">All Statuses</option>
                        <option value="starting">üöÄ Starting</option>
                        <option value="in_progress">‚ö° In Progress</option>
                        <option value="ongoing">üîÑ Ongoing</option>
                        <option value="done">‚úÖ Done</option>
                    </select>
                    <select id="filterPriority" onchange="applyFilters()">
                        <option value="">All Priorities</option>
                        <option value="high">üî¥ High</option>
                        <option value="medium">üü° Medium</option>
                        <option value="low">üü¢ Low</option>
                    </select>
                    <select id="filterAssignee" onchange="applyFilters()">
                    <option value="">All Assignees</option>
                    <option value="unassigned">Unassigned</option>
                </select>
                <select id="filterTag" onchange="applyFilters()">
                    <option value="">All Tags</option>
                </select>
                <button class="btn btn-secondary" onclick="clearFilters()" style="padding: 8px 15px;">
                        Clear Filters
                    </button>
                </div>
            </div>
            


            <!-- Task Stats for Current Project -->
            <div class="stats-container">
                <div class="stat-card status-starting">
                    <div class="stat-value" id="projectStartingTasks">0</div>
                    <div class="stat-label">Starting</div>
                </div>
                <div class="stat-card status-in-progress">
                    <div class="stat-value" id="projectInProgressTasks">0</div>
                    <div class="stat-label">In Progress</div>
                </div>
                <div class="stat-card status-ongoing">
                    <div class="stat-value" id="projectOngoingTasks">0</div>
                    <div class="stat-label">Ongoing</div>
                </div>
                <div class="stat-card status-done">
                    <div class="stat-value" id="projectDoneTasks">0</div>
                    <div class="stat-label">Done</div>
                </div>
            </div>

            <div id="tasksList" class="tasks-list"></div>
        </div>

        <!-- Task Detail Modal -->
        <div id="taskDetailModal" class="modal">
            <div class="modal-content modal-large">
                <span class="close" onclick="closeModal('taskDetailModal')">&times;</span>
                <div id="taskDetail"></div>
            </div>
        </div>

        <!-- User Modal -->
        <div id="userModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('userModal')">&times;</span>
                <h2>Manage Users</h2>
        
                <!-- Existing Users List -->
                <div class="users-list" id="usersList" style="margin-bottom: 20px;"></div>
        
                <hr style="margin: 20px 0; border: 1px solid #ecf0f1;">
        
                <h3>Create New User</h3>
                <form id="userForm">
                    <input type="text" id="username" placeholder="Username" required>
                    <input type="text" id="displayName" placeholder="Display Name" required>
                    <input type="color" id="userColor" value="#3498db">
                    <label>User Color</label>
                    <button type="submit" class="btn btn-primary">Create User</button>
                </form>
            </div>
        </div>

        <!-- Project Modal -->
        <div id="projectModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('projectModal')">&times;</span>
                <h2>Create New Project</h2>
                <form id="projectForm">
                    <input type="text" id="projectName" placeholder="Project Name" required>
                    <textarea id="projectDescription" placeholder="Description"></textarea>
                    
                    <label>Initial Status</label>
                    <select id="projectStatus">
                        <option value="active">Active</option>
                        <option value="on_hold">On Hold</option>
                        <option value="completed">Completed</option>
                    </select>
                    
                    <button type="submit" class="btn btn-primary">Create Project</button>
                </form>
            </div>
        </div>

        <!-- Project Status Change Modal -->
        <div id="projectStatusModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('projectStatusModal')">&times;</span>
                <h2>Change Project Status</h2>
                <div class="status-buttons">
                    <button class="btn btn-status status-active" onclick="changeProjectStatus('active')">
                        üöÄ Active
                    </button>
                    <button class="btn btn-status status-on-hold" onclick="changeProjectStatus('on_hold')">
                        ‚è∏Ô∏è On Hold
                    </button>
                    <button class="btn btn-status status-completed" onclick="changeProjectStatus('completed')">
                        ‚úÖ Completed
                    </button>
                </div>
            </div>
        </div>

        <!-- Task Modal -->
        <div id="taskModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('taskModal')">&times;</span>
                <h2>Create New Task</h2>
                <form id="taskForm">
                    <input type="text" id="taskTitle" placeholder="Task Title" required>
                    <textarea id="taskDescription" placeholder="Task Description"></textarea>
                    
                    <label>Status</label>
                    <select id="taskStatus">
                        <option value="starting">Starting</option>
                        <option value="in_progress">In Progress</option>
                        <option value="ongoing">Ongoing</option>
                        <option value="done">Done</option>
                    </select>

                    <label>Priority</label>
                    <select id="taskPriority">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>

                    <label>Assign To (Multiple)</label>
                    <div id="assigneeCheckboxes" class="checkbox-group"></div>

                    <label>Estimated Completion Date (optional time)</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="radio" name="newTaskDateType" value="date" checked onchange="document.getElementById('taskEstimatedCompletionDate').style.display='block'; document.getElementById('taskEstimatedCompletionDateTime').style.display='none';"> Date Only
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="radio" name="newTaskDateType" value="datetime" onchange="document.getElementById('taskEstimatedCompletionDate').style.display='none'; document.getElementById('taskEstimatedCompletionDateTime').style.display='block';"> Date & Time
                        </label>
                    </div>
                    <input type="date" id="taskEstimatedCompletionDate">
                    <input type="datetime-local" id="taskEstimatedCompletionDateTime" style="display: none;">

                    <button type="submit" class="btn btn-primary">Create Task</button>
                </form>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
